<section id="products" class="product-section">
  <div class="container">
    {% if section.settings.heading != blank %}
      <h3 class="product-heading">{{ section.settings.heading }}</h3>
    {% endif %}

    <div class="product-grid">
      {% for block in section.blocks %}
        {% assign p = block.settings.product %}
        {% if p %}
          <div class="product-card fade-in" onclick="openProduct('{{ p.handle }}')" {{ block.shopify_attributes }}>
            <div class="product-image">
              {% if p.featured_image %}
                <img
                  src="{{ p.featured_image | image_url: width: 1200 }}"
                  alt="{{ p.featured_image.alt
                          | default: p.title
                          | default: p.featured_image.src | split: '/' | last | split: '.' | first
                          | replace: '-', ' ' | replace: '_', ' '
                          | escape }}">
              {% endif %}
              <div class="product-plus-icon">+</div>
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</section>

<style>
.product-grid {
  display: grid;
  gap: 20px;
  grid-template-columns: repeat(3,1fr);
}

.product-card {
  position: relative;
  overflow: hidden;
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0,0,0,.1);
  transition: transform .3s;
  cursor: pointer;
  margin: 10px;
}
.product-card:hover {transform: translateY(-5px);}

/* ✅ fix aspect ratio here */
.product-image {
  width: 100%;
  aspect-ratio: 3 / 4;   /* <-- card always 3:4 instead of 1:1 */
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  background: #f5f5f5;
}

.product-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;  /* keeps proportions but crops nicely */
  transition: transform .3s;
}
.product-card:hover .product-image img {transform: scale(1.05);}

/* plus icon */
.product-plus-icon {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%,-50%);
  width: 50px; height: 50px;
  background: rgba(255,255,255,.9);
  border: 2px solid #333;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 24px; font-weight: 700; color: #333;
  transition: .3s; z-index: 3;
}
.product-card:hover .product-plus-icon {transform: translate(-50%,-50%) scale(1.1);}
.product-plus-icon:hover {background:#333; color:#fff;}

/* responsive */
@media (max-width:768px){
  .product-grid {grid-template-columns: repeat(2,1fr);} /* ✅ 2 per row on mobile */
  .product-heading {text-align: center;}
}
@media (max-width:480px){
  .product-grid {grid-template-columns: 1fr;} /* ✅ 1 per row tiny screens */
}
@media (max-width:1024px) and (min-width:769px){
  .product-grid {grid-template-columns: repeat(2,1fr);}
}
</style>

<script>
document.addEventListener('DOMContentLoaded',()=>{
  function showOnScroll(){
    document.querySelectorAll('.fade-in').forEach(el=>{
      const r=el.getBoundingClientRect();
      if(r.top < innerHeight - 50) el.classList.add('visible');
    });
  }
  addEventListener('scroll',showOnScroll);
  showOnScroll();
});
</script>

{% schema %}
{
  "name": "Product Grid (products)",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Tisso vison in the wild" }
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "settings": [
        { "type": "product", "id": "product", "label": "Select product" }
      ]
    }
  ],
  "max_blocks": 24,
  "presets": [{ "name": "Product Grid (products)" }]
}
{% endschema %}
